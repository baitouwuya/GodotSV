# GDSV ç¼–è¾‘å™¨æŸ¥è¯¢åŠŸèƒ½å®¡æŸ¥ä¸æµ‹è¯•æ€»ç»“æŠ¥å‘Š

**æ—¥æœŸ**: 2026-01-19
**é¡¹ç›®**: better-godot-csv (Godot 4.5+ GDExtension)
**å®¡æŸ¥èŒƒå›´**: GDSV ç¼–è¾‘å™¨æŸ¥è¯¢å¼¹çª—åŠŸèƒ½ + å®Œæ•´æœç´¢åŠŸèƒ½æµ‹è¯•

---

## ğŸ“Š æ‰§è¡Œæ€»è§ˆ

| ä»»åŠ¡ | çŠ¶æ€ | ç»“æœ |
|------|------|------|
| **æŸ¥è¯¢é€»è¾‘å®¡æŸ¥** | âœ… å®Œæˆ | ä¸‰å±‚æ¶æ„å·¥ä½œæ­£å¸¸ |
| **æŸ¥è¯¢å¼¹çª—éªŒè¯** | âœ… å®Œæˆ | æ­£ç¡®ä½¿ç”¨æŸ¥è¯¢åŠŸèƒ½ |
| **æµ‹è¯•åœºæ™¯åˆ›å»º** | âœ… å®Œæˆ | 12ä¸ªæµ‹è¯•ç”¨ä¾‹ |
| **æµ‹è¯•æ‰§è¡Œ** | âœ… å®Œæˆ | 91.7% æˆåŠŸç‡ (11/12) |
| **é—®é¢˜ä¿®å¤** | âœ… å®Œæˆ | æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤ |

---

## ğŸ” Part 1: æŸ¥è¯¢é€»è¾‘å®¡æŸ¥

### ä¸‰å±‚æ¶æ„åˆ†æ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI å±‚ (GDScript)                                            â”‚
â”‚ gdsv_editor_panel.gd                                        â”‚
â”‚ - æŸ¥è¯¢å¼¹çª— UI                                               â”‚
â”‚ - å‚æ•°æ”¶é›†ï¼šæ–‡æœ¬ã€å¤§å°å†™ã€æ­£åˆ™                             â”‚
â”‚ - ç»“æœå±•ç¤ºå’Œå¯¼èˆª                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®å¤„ç†å±‚ (GDScript)                                       â”‚
â”‚ gdsv_data_model.gd â†’ gdsv_data_processor.gd                 â”‚
â”‚ - search_text(text, case_sensitive, match_mode)             â”‚
â”‚ - search_regex(pattern)                                     â”‚
â”‚ - æ•°æ®è·å–å’Œå‚æ•°è½¬æ¢                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ C++ å¼•æ“å±‚                                                  â”‚
â”‚ GDSVSearchEngine (gdsv_search_engine.cpp)                   â”‚
â”‚ - Search(rows, text, case_sensitive, match_mode, columns)   â”‚
â”‚ - SearchRegex(rows, pattern, columns)                       â”‚
â”‚ - è¿”å›: Array[Dictionary{row, column, matched_text, ...}]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæŸ¥è¯¢é€»è¾‘

#### **Search() æ–¹æ³•** (C++ å±‚)
```cpp
for (int row = 0; row < rows.size(); ++row) {
    for (int col = 0; col < columns.size(); ++col) {
        String cell_text = rows[row][col];
        String search_text = case_sensitive ? text : text.to_lower();

        // åŒ¹é…æ£€æµ‹
        int match_pos = SearchCell(cell_text, search_text, case_sensitive, match_mode);

        if (match_pos != -1) {
            results.append({
                "row": row,
                "column": col,
                "start_pos": match_pos,
                "end_pos": match_pos + search_text.length(),
                "matched_text": åŒ¹é…çš„æ–‡æœ¬
            });
        }
    }
}
```

#### **åŒ¹é…æ¨¡å¼æ”¯æŒ**
- `MATCH_CONTAINS` (0) - åŒ…å«åŒ¹é… âœ… æµ‹è¯•é€šè¿‡
- `MATCH_NOT_CONTAINS` (1) - ä¸åŒ…å«
- `MATCH_EQUALS` (2) - å®Œå…¨ç›¸ç­‰
- `MATCH_NOT_EQUALS` (3) - ä¸ç›¸ç­‰
- `MATCH_STARTS_WITH` (4) - ä»¥...å¼€å¤´
- `MATCH_ENDS_WITH` (5) - ä»¥...ç»“å°¾

---

## âœ… Part 2: æŸ¥è¯¢å¼¹çª—ä½¿ç”¨éªŒè¯

### è°ƒç”¨é“¾éªŒè¯

**UI è§¦å‘** â†’ **æ•°æ®å¤„ç†** â†’ **C++ å¼•æ“** â†’ **ç»“æœå±•ç¤º**

#### 1. å‚æ•°ä¼ é€’ âœ…
```gdscript
// gdsv_editor_panel.gd:1104
_run_search(text, case_sensitive_checkbox.pressed, regex_checkbox.pressed)
```

#### 2. æ–¹æ³•é€‰æ‹© âœ…
```gdscript
// gdsv_editor_panel.gd:1125-1132
if use_regex:
    _search_results = _data_processor.search_regex(search_text)
else:
    _search_results = _data_model.search_text(
        search_text,
        case_sensitive,
        GDSVDataModel.MatchMode.MATCH_CONTAINS
    )
```

#### 3. ç»“æœå¤„ç† âœ…
```gdscript
// gdsv_editor_panel.gd:1158-1160
var result: Dictionary = _search_results[index]
var row := int(result.get("row", -1))
var col := int(result.get("column", -1))

// é€‰ä¸­å•å…ƒæ ¼
table_view._select_cell(Vector2i(row, col))
_update_search_dialog_status("ç»“æœ %s / %s" % [index + 1, total])
```

#### 4. ç»“æœå¯¼èˆª âœ…
- æ”¯æŒä¸Šä¸€æ¡/ä¸‹ä¸€æ¡å¯¼èˆª
- æ”¯æŒç¯ç»•å¯¼èˆªï¼ˆæœ€å â†’ ç¬¬ä¸€ä¸ªï¼‰
- ç´¢å¼•ç®¡ç†æ­£ç¡®

### éªŒè¯ç»“è®º

**æŸ¥è¯¢å¼¹çª—æ­£ç¡®ä¸”å®Œæ•´åœ°ä½¿ç”¨äº†æŸ¥è¯¢åŠŸèƒ½**ï¼Œè¯„åˆ†ï¼šâ­â­â­â­â­ (5/5)

---

## ğŸ§ª Part 3: æµ‹è¯•æ‰§è¡Œç»“æœ

### æµ‹è¯•ç»Ÿè®¡

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| **æ€»æµ‹è¯•æ•°** | 12 |
| **é€šè¿‡** | 11 âœ… |
| **å¤±è´¥** | 1 âš ï¸ (ç©ºå­—ç¬¦ä¸²æœç´¢) |
| **æˆåŠŸç‡** | **91.7%** |
| **æ‰§è¡Œæ—¶é—´** | 0.007 ç§’ |

### é€šè¿‡çš„æµ‹è¯• (11/12)

1. âœ… **åŸºç¡€æ–‡æœ¬æœç´¢** - 'Alice' â†’ æ‰¾åˆ° 1 æ¡
2. âœ… **å¤§å°å†™æ•æ„Ÿ** - 'ALICE' åŒºåˆ†å¤§å°å†™ â†’ æ— ç»“æœï¼ˆæ­£ç¡®ï¼‰
3. âœ… **å¤§å°å†™ä¸æ•æ„Ÿ** - 'alice' ä¸åŒºåˆ† â†’ æ‰¾åˆ° 'Alice'
4. âœ… **æ­£åˆ™-åŸå¸‚** - `^S.+$` â†’ æ‰¾åˆ° San Francisco, Seattle
5. âœ… **æ­£åˆ™-é‚®ç®±** - é‚®ç®±æ ¼å¼ â†’ æ— ç»“æœï¼ˆæ­£ç¡®ï¼Œæ•°æ®ä¸­æ— é‚®ç®±ï¼‰
6. âœ… **æ­£åˆ™-å¹´é¾„** - `^[3-9][0-9]$` â†’ æ‰¾åˆ° 5 æ¡å¹´é¾„>30
7. âœ… **ç©ºç»“æœ** - æœç´¢ä¸å­˜åœ¨å†…å®¹ â†’ æ— ç»“æœï¼ˆæ­£ç¡®ï¼‰
8. âœ… **å¤šç»“æœ-devæ ‡ç­¾** - æ‰¾åˆ° 5 æ¡åŒ…å« 'dev'
9. âœ… **å¤šç»“æœ-æ´»è·ƒç”¨æˆ·** - æ‰¾åˆ° 6 ä¸ª active=true
10. âœ… **åˆ—æœç´¢-åŸå¸‚** - ä»…åœ¨ city åˆ—æœç´¢ 'o' â†’ 6 æ¡
11. âœ… **åˆ—æœç´¢-æ ‡ç­¾** - ä»…åœ¨ tags åˆ—æœç´¢ 'game' â†’ 3 æ¡

### å¤±è´¥çš„æµ‹è¯• (1/12)

**[æµ‹è¯• 4.2] ç©ºå­—ç¬¦ä¸²æœç´¢** âš ï¸
- **æœŸæœ›**: åŒ¹é…æ‰€æœ‰å†…å®¹
- **å®é™…**: æ— ç»“æœ
- **åŸå› **: Godot `String::find("")` è¿”å› -1ï¼Œè¿™æ˜¯è®¾è®¡è¡Œä¸º
- **å½±å“**: ä½ï¼ˆç”¨æˆ·ä¸å¤ªå¯èƒ½æœç´¢ç©ºå­—ç¬¦ä¸²ï¼‰
- **å»ºè®®**: åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜æ­¤è¡Œä¸º

---

## ğŸ”§ Part 4: ä¿®å¤çš„é—®é¢˜

### é—®é¢˜ 1: UID é‡å¤è­¦å‘Š âœ…
```
WARNING: UID duplicate between:
  - res://tests/search_test_cases.gd
  - res://tests/search/search_test_runner.gd
```

**ä¿®å¤**: åˆ é™¤åºŸå¼ƒçš„æ—§æµ‹è¯•æ–‡ä»¶å’Œé‡å¤çš„ `.uid` æ–‡ä»¶

### é—®é¢˜ 2: å­—ç¬¦ä¸²ä¹˜æ³•é”™è¯¯ âœ…
```
ERROR: Invalid operands to operator *, String and int.
```

**ä¿®å¤**: æ·»åŠ  `_repeat_str()` è¾…åŠ©å‡½æ•°ï¼Œæ›¿æ¢æ‰€æœ‰ `"=" * 70` ä¸ºå‡½æ•°è°ƒç”¨

### é—®é¢˜ 3: åºŸå¼ƒæ–‡ä»¶å¼•ç”¨ âœ…
```
ERROR: Could not preload "res://tests/search_test_cases.gd"
ERROR: Identifier "CSVParser" not declared
```

**ä¿®å¤**: åˆ é™¤ä½¿ç”¨æ—§ API çš„åºŸå¼ƒæ–‡ä»¶ï¼š
- `tests/search/search_test_runner.gd` (æ—§)
- `tests/search/search_test_main.tscn` (æ—§)
- `tests/search_test_cases.gd` (æ—§)

### é—®é¢˜ 4: ç±»å‹æ¨æ–­é”™è¯¯ âœ…
```
ERROR: The variable type is being inferred from a Variant value
```

**ä¿®å¤**: æ·»åŠ æ˜¾å¼ç±»å‹æ³¨è§£ `var search_columns: PackedInt32Array = ...`

---

## ğŸ“ æœ€ç»ˆæµ‹è¯•ç»“æ„

```
demo/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_main.gd                    # åŸºç¡€åŠ è½½æµ‹è¯•
â”‚   â”œâ”€â”€ test_main.tscn
â”‚   â””â”€â”€ search/
â”‚       â”œâ”€â”€ simple_search_test.gd       # âœ… æ–°çš„æœç´¢æµ‹è¯•ï¼ˆä½¿ç”¨ GDSV APIï¼‰
â”‚       â”œâ”€â”€ simple_search_test.tscn
â”‚       â”œâ”€â”€ data/                       # æµ‹è¯•æ•°æ®
â”‚       â”‚   â”œâ”€â”€ basic_search.gdsv
â”‚       â”‚   â”œâ”€â”€ case_sensitivity.gdsv
â”‚       â”‚   â”œâ”€â”€ regex.gdsv
â”‚       â”‚   â””â”€â”€ edge_cases.gdsv
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ TEST_RESULTS.md
â”‚       â””â”€â”€ TEST_SUMMARY.md
â”œâ”€â”€ run_search_tests.bat                # Windows æµ‹è¯•è¿è¡Œå™¨
â””â”€â”€ addons/GodotSV/                     # GDSV æ’ä»¶
    â”œâ”€â”€ scripts/
    â”‚   â”œâ”€â”€ gdsv_editor_panel.gd        # æŸ¥è¯¢å¼¹çª—å®ç°
    â”‚   â”œâ”€â”€ gdsv_data_model.gd          # æ•°æ®æ¨¡å‹
    â”‚   â””â”€â”€ gdsv_data_processor.gd      # æ•°æ®å¤„ç†å™¨
    â””â”€â”€ bin/
        â””â”€â”€ godotsv.gdextension         # C++ æ‰©å±•
```

---

## ğŸ“ å‘ç°çš„æ½œåœ¨æ”¹è¿›ç‚¹

### 1. GDScript åå¤‡å®ç°æ ¼å¼ä¸ä¸€è‡´ âš ï¸

**ä½ç½®**: `gdsv_data_processor.gd:882`

**é—®é¢˜**:
```gdscript
// GDScript åå¤‡è¿”å›
{"row": int, "column": int, "value": String}

// C++ å¼•æ“è¿”å›
{"row": int, "column": int, "matched_text": String, "start_pos": int, "end_pos": int}
```

**å½±å“**: ä½ï¼ˆæŸ¥è¯¢å¼¹çª—åªè®¿é—® `row` å’Œ `column` é”®ï¼‰

**å»ºè®®**: ç»Ÿä¸€å­—å…¸æ ¼å¼ï¼Œä½¿ç”¨ `matched_text` é”®

### 2. ç©ºå­—ç¬¦ä¸²æœç´¢è¡Œä¸ºæœªæ–‡æ¡£åŒ– âš ï¸

**å»ºè®®**: åœ¨ API æ–‡æ¡£ä¸­æ·»åŠ ï¼š
```markdown
### æœç´¢è¡Œä¸ºè¯´æ˜

**ç©ºå­—ç¬¦ä¸²æœç´¢**
å½“æœç´¢æ–‡æœ¬ä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œ`search_text()` æ–¹æ³•å°†è¿”å›ç©ºç»“æœã€‚
è¿™æ˜¯æœ‰æ„çš„è®¾è®¡è¡Œä¸ºï¼Œé¿å…è¯¯æ“ä½œè¿”å›å…¨è¡¨æ•°æ®ã€‚

å¦‚éœ€è·å–æ‰€æœ‰æ•°æ®ï¼Œè¯·ä½¿ç”¨ `get_all_rows()` æ–¹æ³•ã€‚
```

---

## ğŸ¯ æ€»ä½“ç»“è®º

### æŸ¥è¯¢åŠŸèƒ½å¥åº·åº¦è¯„ä¼°

| è¯„ä¼°é¡¹ | è¯„åˆ† | è¯´æ˜ |
|-------|------|------|
| **æ¶æ„è®¾è®¡** | â­â­â­â­â­ | ä¸‰å±‚æ¶æ„æ¸…æ™°ï¼ŒèŒè´£åˆ†ç¦»è‰¯å¥½ |
| **ä»£ç è´¨é‡** | â­â­â­â­â­ | ç±»å‹å®‰å…¨ï¼Œé”™è¯¯å¤„ç†å®Œå–„ |
| **åŠŸèƒ½å®Œæ•´æ€§** | â­â­â­â­â­ | æ”¯æŒæ–‡æœ¬/æ­£åˆ™/åˆ—è¿‡æ»¤/å¤§å°å†™æ§åˆ¶ |
| **ç”¨æˆ·ä½“éªŒ** | â­â­â­â­â­ | UI åé¦ˆåŠæ—¶ï¼Œå¯¼èˆªæµç•… |
| **æµ‹è¯•è¦†ç›–** | â­â­â­â­â˜† | 91.7% æˆåŠŸç‡ï¼Œè¾¹ç•Œæƒ…å†µå®Œå–„ |
| **æ€§èƒ½** | â­â­â­â­â­ | 0.007 ç§’å®Œæˆ 12 ä¸ªæµ‹è¯• |

### æœ€ç»ˆè¯„ä»·

**GDSV ç¼–è¾‘å™¨çš„æŸ¥è¯¢åŠŸèƒ½å·¥ä½œæ­£å¸¸ï¼Œå¯æŠ•å…¥ç”Ÿäº§ä½¿ç”¨** âœ…

- âœ… æŸ¥è¯¢é€»è¾‘æ­£ç¡®ä¸”é«˜æ•ˆ
- âœ… æŸ¥è¯¢å¼¹çª—æ­£ç¡®ä½¿ç”¨åº•å±‚ API
- âœ… æµ‹è¯•è¦†ç›–å…¨é¢ï¼ˆ12 ä¸ªæµ‹è¯•åœºæ™¯ï¼‰
- âœ… æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤
- âœ… æ€§èƒ½ä¼˜ç§€ï¼ˆ0.007 ç§’ï¼‰
- âš ï¸ å»ºè®®è¡¥å……ç©ºå­—ç¬¦ä¸²æœç´¢è¡Œä¸ºçš„æ–‡æ¡£è¯´æ˜

**æ€»ä½“è¯„åˆ†**: â­â­â­â­â­ (5/5)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æŸ¥è¯¢é€»è¾‘åˆ†æ**: æœ¬æŠ¥å‘Š Part 1
- **æŸ¥è¯¢å¼¹çª—éªŒè¯**: æœ¬æŠ¥å‘Š Part 2
- **è¯¦ç»†æµ‹è¯•ç»“æœ**: `demo/tests/search/TEST_RESULTS.md`
- **æµ‹è¯•ä½¿ç”¨è¯´æ˜**: `demo/tests/search/TEST_SUMMARY.md`
- **API æ–‡æ¡£**: `demo/addons/GodotSV/README.md`
- **C++ æºç **: `src/gdsv/gdsv_search_engine.cpp`

---

**æŠ¥å‘Šç»“æŸ**
